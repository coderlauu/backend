### postinstall
- postinstall æ˜¯npmçš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¼šåœ¨npm installæ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨è§¦å‘
- æ‰§è¡Œæ­¤å‘½ä»¤ä¹‹åï¼Œè¿è¡ŒgenEnvTypesæ–‡ä»¶ï¼Œè¯»å– .env æ–‡ä»¶ï¼Œç”Ÿæˆtypes/env.d.ts æ–‡ä»¶ï¼Œä¸ºç¯å¢ƒå˜é‡æä¾›TSæ”¯æŒ
```json
"scripts": {
    "postinstall": "npm run gen-env-types",
    "gen-env-types": "npx tsx scripts/genEnvTypes.ts || true",
}
```

### `process.env.npm_lifecycle_event`
- process.env.npm_lifecycle_event æ˜¯ npm æä¾›çš„ç¯å¢ƒå˜é‡ï¼Œå®ƒåŒ…å«å½“å‰è¿è¡Œçš„ npm script çš„åç§°ã€‚æ¯”å¦‚å½“ä½ è¿è¡Œ npm run typeorm æ—¶ï¼Œè¿™ä¸ªå˜é‡çš„å€¼å°±æ˜¯ "typeorm"ã€‚

### æ•°æ®åº“é…ç½® `typeorm` -- é€šè¿‡docker composeåœ¨dockerä¸­å¯åŠ¨æ•°æ®åº“æœåŠ¡

#### ç¼–å†™ docker-compose.yml
```yml
å‚è€ƒocker-compose.ymlæ–‡ä»¶
å®Œå–„mysqlé…ç½®
```

#### å¯åŠ¨MySqlæœåŠ¡   
```sh
docker compose --env-file .env --env-file .env.development run -d --service-ports mysql
```
1. æ­¤å‘½ä»¤æ‰§è¡Œåï¼Œä¼šåœ¨`docker-compose.yml`ä¸­è¯»å– `mysql` çš„ç›¸å…³é…ç½®ä¿¡æ¯
2. æ£€æŸ¥ç½‘ç»œ `nest_react_admin_net` æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼›ä»Docker Hubä¸Šæ‹‰å–å¯¹åº”é•œåƒ
3. åŠ è½½ `.env` å’Œ `.env.development` ç¯å¢ƒå˜é‡
4. åˆ›å»ºå¹¶å¯åŠ¨ MySQL å®¹å™¨  
  4.0 åˆ›å»ºå®¹å™¨
  4.1 æŒ‚è½½æ•°æ®å·ï¼š
    - ./__data/mysql â†’ /var/lib/mysql (æ•°æ®æŒä¹…åŒ–)
      - å½“ä½ åœ¨å¼€å‘ç¯å¢ƒä¸‹å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ“ä½œï¼Œéƒ½ä¼šå®æ—¶è¢«åŒæ­¥åˆ°/var/lib/mysqlä¸‹ï¼Œä¸‹æ¬¡å¯åŠ¨dockeræ—¶ï¼Œä¼šåŠ è½½åˆ°è¿™äº›æ•°æ®
    - ./deploy/sql â†’ /docker-entrypoint-initdb.d/ (åˆå§‹åŒ–è„šæœ¬)
  4.2 è®¾ç½®ç¯å¢ƒå˜é‡
  4.3 å¯åŠ¨ MySQL æœåŠ¡
5. æ•°æ®åº“åˆå§‹åŒ–é˜¶æ®µ â­
MySQL å®˜æ–¹é•œåƒæœ‰ä¸ªç‰¹æ®Šæœºåˆ¶ï¼š   
âœ… ä¼šè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬çš„æƒ…å†µï¼š
- å½“ /var/lib/mysql ç›®å½•ä¸ºç©ºæ—¶ï¼ˆç¬¬ä¸€æ¬¡å¯åŠ¨ï¼‰
- è‡ªåŠ¨æ‰§è¡Œ /docker-entrypoint-initdb.d/ ç›®å½•ä¸‹çš„è„šæœ¬ï¼ˆæ”¯æŒ.sqlã€.shã€.sql.gzæ–‡ä»¶ç±»å‹ï¼‰   
âŒ ä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬çš„æƒ…å†µï¼š
- å½“ ./__data/mysql/ æ–‡ä»¶å¤¹å·²å­˜åœ¨æ•°æ®æ—¶
- è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨çœ‹åˆ°æ³¨é‡Šï¼š# åˆå§‹åŒ–çš„è„šæœ¬ï¼Œè‹¥ ./__data/mysql/ æ–‡ä»¶å¤¹å­˜åœ¨æ•°æ®ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

#### Dockerfile
- åªæœ‰åœ¨docker-compose.ymlä¸­ æŒ‡å®šäº† build: æ‰ä¼šæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š
```yml
  nest-react-admin-server:
    # build: ä¼šåœ¨å½“å‰ç›®å½•ï¼ˆ.ï¼‰å¯»æ‰¾ Dockerfileï¼Œå¹¶æ‰§è¡Œä»¥æ„å»ºé•œåƒ
    build:
      context: .
      args:
        - PROJECT_DIR=${PROJECT_DIR}
    ...
```
```yml
// ...å¿½ç•¥éƒ¨åˆ†ä»£ç 
ENTRYPOINT ./wait-for-it.sh $DB_HOST:$DB_PORT -- pnpm migration:run && pm2-runtime ecosystem.config.js
```

##### wait-for-it.sh è„šæœ¬ä½œç”¨
- ç­‰å¾…ä¾èµ–æœåŠ¡ï¼šç¡®ä¿ MySQL å¯è¿æ¥åå†å¯åŠ¨åº”ç”¨
- é¿å…å¯åŠ¨å¤±è´¥ï¼šé˜²æ­¢åº”ç”¨åœ¨æ•°æ®åº“æœªå°±ç»ªæ—¶å¯åŠ¨
##### PM2 é›†ç¾¤æ¨¡å¼
- pm2-runtime - å‰å°è¿è¡Œæ¨¡å¼ï¼ˆé€‚åˆå®¹å™¨ï¼‰
- ecosystem.config.js - PM2 é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒé›†ç¾¤æ¨¡å¼

------------------------
- database.module.ts é™¤äº†æ­¤æ–‡ä»¶çš„é…ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯¹å®ä½“è¿›è¡Œæ•°æ®éªŒè¯å’Œå”¯ä¸€æ€§çº¦æŸ
- è§ providers = [EntityExistConstraint, UniqueConstraint]
------------------------

### Redisé…ç½®

### ç”Ÿæˆé¡¹ç›®æ–‡æ¡£
è¿™æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆé¡¹ç›®æ–‡æ¡£çš„npmè„šæœ¬å‘½ä»¤ã€‚
```json
"scripts": {
    "doc": "compodoc -p tsconfig.json -s",
}
```
- compodoc æ˜¯ä¸€ä¸ªTypeScripté¡¹ç›®æ–‡æ¡£ç”Ÿæˆå·¥å…·ï¼Œå‚æ•°å«ä¹‰ï¼š
- -p tsconfig.jsonï¼šæŒ‡å®šTypeScripté…ç½®æ–‡ä»¶
- -sï¼šç”Ÿæˆæ–‡æ¡£åå¯åŠ¨æœ¬åœ°æœåŠ¡å™¨é¢„è§ˆæ–‡æ¡£
- è¿è¡Œ npm run doc ä¼šè‡ªåŠ¨åˆ†æä½ çš„TypeScriptä»£ç ï¼Œç”ŸæˆAPIæ–‡æ¡£å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¢„è§ˆã€‚

### å…³äº `--watch` æ¨¡å¼ ä¸ `module.hot` çš„åŒºåˆ«
- `--watch` æ¨¡å¼ï¼Œæ˜¯åº”ç”¨çº§åˆ«çš„é‡å¯
- `module.hot` æ¨¡å—çº§çƒ­æ›¿æ¢ - ä¸ä¼šä¸¢å¤±å†…å­˜ä¸­çš„çŠ¶æ€ï¼ˆå¦‚ WebSocket è¿æ¥ã€ç¼“å­˜ç­‰ï¼‰

#### ä¸¤è€…æœ‰ä¼˜å…ˆçº§ï¼š
- å¦‚æœæ”¯æŒ HMRï¼Œä¼šä¼˜å…ˆä½¿ç”¨ module.hotï¼ˆæ›´å¿«ï¼Œä¿æŒçŠ¶æ€ï¼‰
- å¦‚æœä¸æ”¯æŒ HMR æˆ– HMR å¤±è´¥ï¼Œæ‰ä¼šå›é€€åˆ° --watchï¼ˆè¿›ç¨‹é‡å¯ï¼‰

--watch æ˜¯å…œåº•æœºåˆ¶ï¼Œmodule.hot æ˜¯æ€§èƒ½ä¼˜åŒ–ã€‚åœ¨æ”¯æŒ HMR çš„ç¯å¢ƒä¸‹ï¼ˆå¦‚ webpack-dev-serverï¼‰ï¼Œä¼šä¼˜å…ˆä½¿ç”¨çƒ­æ›¿æ¢è€Œä¸æ˜¯è¿›ç¨‹é‡å¯ã€‚

### é…ç½®å…¨å±€æ‹¦æˆªå™¨ã€ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­ç”Ÿæ•ˆã€‘
```ts
// main.ts
if (isDev) {
  app.useGlobalInterceptors(new LoggingInterceptor())
}
```
#### ä¸ºä»€ä¹ˆä»…åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Ÿ
ğŸ“Š å®é™…å¯¹æ¯”
- å¼€å‘ç¯å¢ƒï¼ˆé€‚åˆè¯¦ç»†æ—¥å¿—ï¼‰
  - è¯·æ±‚é‡å°‘ï¼ˆæ¯å¤©å‡ ç™¾åˆ°å‡ åƒï¼‰
  - éœ€è¦è¯¦ç»†è°ƒè¯•ä¿¡æ¯
  - æ€§èƒ½è¦æ±‚ä¸é«˜
  - å­˜å‚¨æˆæœ¬å¯å¿½ç•¥
- ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦ç²¾ç®€æ—¥å¿—ï¼‰
  - è¯·æ±‚é‡å¤§ï¼ˆæ¯å¤©å‡ ä¸‡åˆ°å‡ ç™¾ä¸‡ï¼‰
  - é‡ç‚¹å…³æ³¨é”™è¯¯å’Œæ€§èƒ½
  - æ€§èƒ½è¦æ±‚æé«˜
  - å­˜å‚¨æˆæœ¬æ•æ„Ÿ

ğŸ’¡ æ€»ç»“
- âœ… é¿å…æ€§èƒ½æŸè€—
- âœ… æ§åˆ¶æ—¥å¿—é‡
- âœ… é™ä½å­˜å‚¨æˆæœ¬
- âœ… å‡å°‘å®‰å…¨é£é™©
- âœ… ç¬¦åˆæ—¥å¿—çº§åˆ«æœ€ä½³å®è·µ

### é›†æˆ æ—¥å¿—æœåŠ¡ç³»ç»Ÿ winston
```json
  "dependencies": {
    "winston": "^3.17.0",
    "winston-daily-rotate-file": "^5.0.0"
  }
```
å¹¶å°†æ—¥å¿—è®°å½•åˆ° `logs/*` ç›®å½•ä¸‹

### NestJsé…ç½®æ¨¡å— `@nestjs/config`
å°†å„æ¨¡å—çš„é…ç½®è§£è€¦å¼€ï¼Œå„æ¨¡å—çš„é…ç½®åˆ†åˆ«ä» `.env\.env.*` ä¸­è·å–

### Redisé€‚é…å™¨
```ts
// main.ts
app.useWebSocketAdapter(new RedisIoAdapter(app))
```
#### èƒŒæ™¯
åœ¨å•å®ä¾‹åº”ç”¨ä¸­ï¼Œæ‰€æœ‰çš„ WebSocket è¿æ¥éƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥ç›´æ¥é€šä¿¡ã€‚ä½†åœ¨é›†ç¾¤/å¤šå®ä¾‹ç¯å¢ƒä¸‹ï¼š
```text
Client A â”€â”€â†’ Server Instance 1
Client B â”€â”€â†’ Server Instance 2
Client C â”€â”€â†’ Server Instance 3
```
å¦‚æœ Client A æƒ³ç»™ Client B å‘æ¶ˆæ¯ï¼Œä½†ä»–ä»¬è¿æ¥åˆ°ä¸åŒçš„æœåŠ¡å™¨å®ä¾‹ï¼Œç›´æ¥é€šä¿¡å°±ä¸å¯èƒ½äº†ï¼
ğŸ™‹ğŸ»â€â™€ï¸æ‰€ä»¥ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé›†ç¾¤/å¤šå®ä¾‹çš„é€šä¿¡å¾€å¾€æ˜¯ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ï¼Œåœ¨è¿™é‡Œé€šè¿‡RedisAdapteræ¥å®ç°ã€‚
#### è§£å†³æ–¹æ¡ˆ
```ts
export class RedisIoAdapter extends IoAdapter {
  createIOServer(port: number, options?: any) {
    const server = super.createIOServer(port, options)

    // è·å– Redis å‘å¸ƒ/è®¢é˜…å®¢æˆ·ç«¯
    const { pubClient, subClient } = this.app.get(REDIS_PUBSUB)

    // åˆ›å»º Redis é€‚é…å™¨
    const redisAdapter = createAdapter(pubClient, subClient, {
      key: RedisIoAdapterKey, // Redis key å‰ç¼€
      requestsTimeout: 10000, // è¯·æ±‚è¶…æ—¶æ—¶é—´
    })

    // å°† Redis é€‚é…å™¨åº”ç”¨åˆ° Socket.IO æœåŠ¡å™¨
    server.adapter(redisAdapter)
    return server
  }
}
```
#### ğŸ”„ å·¥ä½œåŸç†
```text
Client A (Server 1) â”€â”€å‘æ¶ˆæ¯â”€â”€â†’ Redis â”€â”€å¹¿æ’­â”€â”€â†’ All Servers â”€â”€æ¨é€â”€â”€â†’ All Clients
                                    â†“
Client B (Server 2) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Server 2 æ”¶åˆ°å¹¿æ’­
Client C (Server 3) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Server 3 æ”¶åˆ°å¹¿æ’­
```

### å…¨å±€æ•°æ®éªŒè¯ç®¡é“
```json
"dependencies": {
  "class-transformer": "^0.5.1",
  "class-validator": "^0.14.1",
}
```
è‡ªåŠ¨éªŒè¯æ‰€æœ‰ API è¯·æ±‚çš„å‚æ•°ï¼Œç¡®ä¿æ•°æ®ç¬¦åˆ DTO ç±»ä¸­å®šä¹‰çš„éªŒè¯è§„åˆ™ã€‚

#### ğŸ›¡ï¸ä½œç”¨
âœ… è‡ªåŠ¨æ•°æ®éªŒè¯
âœ… æ™ºèƒ½ç±»å‹è½¬æ¢ï¼šè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œå‡å°‘ç±»å‹é”™è¯¯
âœ… å®‰å…¨å­—æ®µè¿‡æ»¤ï¼šè¿‡æ»¤æ¶æ„å­—æ®µï¼Œé˜²æ­¢å‚æ•°æ±¡æŸ“
âœ… å‹å¥½é”™è¯¯æç¤ºï¼šè¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
âœ… ç»Ÿä¸€éªŒè¯æ ‡å‡†

### å¼•å…¥ `swagger`

```json
  "dependencies": {
    "@nestjs/swagger": "^11.1.1",
  }
```